# Performance on MUSA S4000

# 性能测试
测试了Opensora 16x256x256 多卡间性能和最终loss
## 总览
| 配置                | 分布式信息       | 吞吐量(图/秒/GPU)  | 吞吐量(token/秒/GPU) | Final loss          |
|-------------------|--------------|----------------------- |---------------------|---------------------|
| 16x256            | 1卡          | 0.645                  | 330.487             |0.000104736167192    |
| 16x256            | 2卡          | 0.833                  | 213.206             |0.002376629039645    |
| 16x256            | 4卡          | 1.717                  | 219.723             |0.002376629039645    |
| 16x256            | 8卡          | 2.025                  | 129.630             |0.010965066030621    |

## 具体表现

### 算力使用明细
| 分布式信息      | 批次大小    | 序列长度     |  TFLOPS每GPU    |TFLOPS每GPU(Megatron) | 延迟(s)     |
|--------------- |------------|------------- |----------------|---------------------|-----------|
| 1卡            | 1          | 512          | 0.029          | 0.011               | 1.549      |
| 2卡            | 1          | 512          | 0.019          | 0.007               | 2.401      |
| 4卡            | 1          | 512          | 0.020          | 0.007               | 2.330      |
| 8卡            | 1          | 512          | 0.012          | 0.004               | 3.950      |

### 时间使用明细
| 分布式信息      | 平均数据传输延迟(ms)  | 平均前向传播延迟(ms) | 平均反向传播延迟(ms)  | 平均优化器更新延迟(ms) | 平均单步延迟延迟(ms)   |
|--------------- |---------------------|---------------------|---------------------|-----------------------|-----------------------|
| 1卡            | 389.86              | 249.21              | 910.16              | 727.68               | 1549.23               |
| 2卡            | 536.59              | 354.97              | 1509.88             | 1234.71              | 2401.44               |
| 4卡            | 565.40              | 248.97              | 1515.84             | 1007.59              | 2330.21               |
| 8卡            | 919.17              | 362.73              | 2667.82             | 2162.11              | 3949.72               |

### 内存使用明细
| 分布式信息      | 权重(GB)               | 梯度(GB)              | 优化器(GB)            | 激活值(GB)             | 峰值(GB)                | 碎片(GB)                | 最终GPU存储空间占用(GB) | 最终CPU存储空间占用(GB) |
|--------------- |---------------------|---------------------|---------------------|---------------------|-----------------------|-----------------------|-----------------------|-----------------------|
| 1卡            | 0.707              | 0.707              | 21.182              | 3.572               | 26.169               | 1.378               | 21.889               |9.905               |
| 2卡            | 0.707              | 0.707              | 16.891               | 1.437               | 19.742                 | 3.613               | 17.598               | 9.941               |
| 4卡            | 0.707              | 0.707              | 14.737               | 1.835               | 17.987                 | 2.001               | 15.445               | 9.910               |
| 8卡            | 0.707              | 0.707              | 13.687               | 2.885               | 17.987                 | 4.962               | 14.395               | 9.936               |
